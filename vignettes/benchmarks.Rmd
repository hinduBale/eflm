---
title: "Comparing 'glm' and 'eglm' computing time and memory allocation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{benchmarks}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Gaussian regression

The next example compares the computing times for simulated data running in a
Intel i5 (8th gen) laptop. This illustrates quite well that 'eglm' performs 
*worse* than 'glm' in median time when the design matrix of dimension 
$N \times P$ is such that $N < 7P$.

For example, with a design matrix of $2,500 \times 500$, fitting the model 
$y = \beta X + \varepsilon$ (with intercept) by using 'eglm', takes around 120%
of the time it takes with 'glm'.

Doing the same with a design matrix of $10,000 \times 500$ by using 'eglm', 
takes around 75% of the time it takes with 'glm'. This is because of the 
computation taken to transform the design matrix.

Also, doing the same with a design matrix of $25,000 \times 500$ by using
'eglm', takes around 60% of the time it takes with 'glm'. This is because of the
computation taken to transform the design matrix.

```{r, eval = FALSE}
library(eflm)

n <- 100000000; p <- 10
set.seed(1813)
M <- as.data.frame(matrix(rnorm(n * p), nrow = n, ncol = p + 1))
colnames(M) <- c("y", paste0("x", seq_len(p)))

model <- paste("y ~", paste(paste0("x", seq_len(p)), collapse = " + "))

benchmarks <- list()
r <- 10^(1:8)
for (i in seq_along(r)) {
  out <- bench::mark(
    glm(model, data = M[1:r[i],])$coefficients,
    eglm(model, data = M[1:r[i],], bypass = F)$coefficients
  )
  
  out$dimensions <- dim(M[1:r[i],])[1] * dim(M[1:r[i],])[2]
  
  benchmarks[[i]] <- out
}
```

```{r, eval = FALSE}
library(ggplot2)

benchmarks2 <- do.call("rbind", benchmarks)

ggplot(benchmarks2, aes(x = dimensions, y = median, color = as.character(expression))) +
  geom_point() +
  geom_line() +
  bench::scale_y_bench_time() +
  scale_x_log10(
    breaks = scales::trans_breaks("log10", function(x) 10^x),
    labels = scales::trans_format("log10", scales::math_format(10^.x))
  ) +
  coord_fixed() +
  theme(panel.grid.minor = element_blank()) +
  labs(title = "log-log plot of design matrix size vs fitting time", x = NULL, y = NULL)
```
